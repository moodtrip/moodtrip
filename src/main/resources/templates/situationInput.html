<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="icon" href="/images/moodtrip.png"/>
    <link rel="apple-touch-icon" href="/images/moodtrip.png"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상황 입력 - MOODTRIP</title>
    <style>
        /* ▼▼▼ 1. 부드러운 배경 애니메이션 정의 ▼▼▼ */
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        /* ▲▲▲ 애니메이션 정의 끝 ▲▲▲ */

        /* ▼▼▼ 2. 기존 body 스타일을 애니메이션 스타일로 교체 ▼▼▼ */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;

            /* 요청하신 5가지 색상 + 연한 회색 순환 적용 */
            background: linear-gradient(135deg,
                /* 1. 노랑 */ #fdf6d2, #fde7c8,
            #f0f0f0, /* 연한 회색 */
                /* 2. 주황 */ #fed8b1, #fbc190, /* 연한 주황 계열 */
            #f0f0f0, /* 연한 회색 */
                /* 3. 핑크 */ #fbc2eb, #fad0c4,
            #f0f0f0, /* 연한 회색 */
                /* 4. 보라 */ #d8bfff, #e6e6fa,
            #f0f0f0, /* 연한 회색 */
                /* 5. 녹색 */ #b2f7d1, #e3f7c4,
            #f0f0f0, /* 연한 회색 */
                /* 6. 다시 노랑 (순환) */ #fdf6d2, #fde7c8
            );

            /* 그라데이션 크기를 12개 구간(6*2)에 맞게 키웁니다. */
            background-size: 1200% 1200%;
            /* 36초(약 3초 * 12구간) 동안 그라데이션을 이동시킵니다. */
            animation: gradientShift 36s ease-in-out infinite;

            min-height: 100vh;
            color: #333; /* 기본 텍스트 색상 */
            padding: 80px 10px 5px 10px; /* 상단에 헤더 공간 확보 */
            box-sizing: border-box;
            display: flex; /* 컨테이너 중앙 정렬을 위해 */
            align-items: flex-start; /* 상단부터 시작 */
            justify-content: center;
        }
        /* ▲▲▲ body 스타일 교체 완료 ▲▲▲ */


        /* Header 스타일 */
        #header-logo {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1500;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 20px 0;
        }

        #logo img {
            height: 50px;
            width: auto;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        .header-line {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.5) 50%, transparent 100%);
            margin: 15px 0 0 0;
            width: 100%;
        }

        /* ▼▼▼ 3. emotionSelection.html의 구조 적용 ▼▼▼ */
        .container {
            background: rgba(255, 255, 255, 0.75); /* 반투명 + 블러 */
            backdrop-filter: blur(10px);
            border-radius: 45px;
            padding: 20px; /* 내부 패딩 통일 */
            width: 100%;
            max-width: 800px; /* 너비 조정 */
            margin: 10px auto auto auto;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out;
            display: flex;
            flex-direction: column;
            /* 높이 계산: (헤더 패딩 80px) + (컨테이너 마진 10px) + (body 패딩 5px) = 95px */
            max-height: calc(100vh - 95px);
        }

        .page-header {
            text-align: center;
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.75); /* 반투명 + 블러 */
            backdrop-filter: blur(10px);
            z-index: 100;
            padding: 10px;
            margin: -5px; /* container padding에 맞춤 */
            border-radius: 45px 45px 0 0;
        }

        .title {
            font-size: 32px;
            font-weight: bold;
            margin: 5px;
            color: #2c3e50;
            padding-top: 15px; /* 헤더 패딩 보정 */
        }

        .subtitle {
            font-size: 18px;
            margin: 10px;
            color: #666;
        }

        .instruction {
            font-size: 16px;
            color: #888;
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 10px; /* 추가 */
        }

        .content-area {
            /* 이 영역이 스크롤됩니다 */
            overflow-y: auto;
            padding: 25px 20px 10px 20px;
        }

        .content-area::-webkit-scrollbar {
            width: 8px;
        }
        .content-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        .content-area::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            border-radius: 10px;
        }
        .content-area::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #89b3f8, #b0e0f8);
        }

        .input-section {
            margin-bottom: 10px;
        }

        .text-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            font-size: 18px;
            font-family: inherit;
            resize: vertical;
            box-sizing: border-box;
            transition: all 0.3s ease;
            background: white;
            line-height: 1.6;
        }

        .text-input:focus {
            outline: none;
            border-color: #a1c4fd; /* 파스텔 블루 */
            box-shadow: 0 0 0 5px rgba(161, 196, 253, 0.25);
            transform: translateY(-2px);
        }

        .text-input::placeholder {
            color: #aaa;
            line-height: 1.6;
        }

        .char-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }

        .suggestions {
            margin: 20px 0;
        }

        .suggestions-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
            text-align: center;
        }

        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        .suggestion-tag {
            padding: 10px 18px;
            background: rgba(161, 196, 253, 0.1); /* 파스텔 블루 연하게 */
            color: #5a6fd8; /* 파스텔 블루 진하게 */
            border: 2px solid rgba(161, 196, 253, 0.2);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .suggestion-tag:hover {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb); /* 파스텔 블루 */
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(161, 196, 253, 0.3);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            /* margin-top: 30px; -> fixed-bottom에서 패딩으로 대체 */
        }

        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        /* 버튼 스타일 (emotionSelection.html과 동일하게) */
        .btn-primary {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb); /* 파스텔 블루 */
            color: white;
            opacity: 0.5;
            pointer-events: none;
        }

        .btn-primary.active {
            opacity: 1;
            pointer-events: all;
        }

        .btn-primary.active:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(161, 196, 253, 0.4);
        }

        .btn-secondary {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
            border: 2px solid #6c757d;
        }

        .btn-secondary:hover {
            background: #6c757d;
            color: white;
            transform: translateY(-3px);
        }

        .examples-section {
            margin: 30px 0;
            text-align: left;
        }

        .examples-title {
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            color: #555;
            text-align: center;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .example-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #a1c4fd; /* 파스텔 블루 */
            font-size: 14px;
            color: #555;
            line-height: 1.4;
        }

        .example-label {
            font-weight: 600;
            color: #728ecf; /* 파스텔 블루 진하게 */
            margin-bottom: 5px;
        }

        .fixed-bottom {
            position: sticky;
            bottom: 0;
            background: rgba(255, 255, 255, 0.75); /* 반투명 + 블러 */
            backdrop-filter: blur(10px);
            padding: 20px;
            margin: -5px; /* container padding에 맞춤 */
            border-radius: 0 0 45px 45px;
            z-index: 100;
        }
        /* ▲▲▲ 3단 구조 스타일 끝 ▲▲▲ */


        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .floating-animation {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* ▼▼▼ 로딩 오버레이 스타일 (수정) ▼▼▼ */
        #loadingOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.9); /* 0.98 -> 0.9 */
            backdrop-filter: blur(15px);
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: #333;
            border-radius: 45px; /* 곡률 추가 */
            /* 화면 전체 대신 컨테이너 크기에 맞추려면 아래 주석 해제 (단, fixed 포지션이라 어려움) */
            /* position: absolute; */
            /* width: 100%; height: 100%; left:0; top: 0; */
            /* box-sizing: border-box; */
        }
        /* ▲▲▲ 로딩 오버레이 수정 끝 ▲▲▲ */

        .loader {
            position: relative;
            width: 60px;
            height: 60px;
            animation: loader-rotate 0.8s infinite linear;
            margin-bottom: 40px;
        }
        .loader:before,
        .loader:after {
            content: '';
            position: absolute;
            margin: -30px 0 0 -30px;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            background-color: #a1c4fd; /* 파스텔 블루 */
            border-radius: 50%;
            animation: loader-bounce 1.5s infinite ease-in-out;
        }
        .loader:after {
            background-color: #c2e9fb; /* 파스텔 스카이 */
            animation-direction: reverse;
        }
        @keyframes loader-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes loader-bounce {
            0% { transform: scale(0.2); left: 0%; }
            50% { transform: scale(1.0); left: 50%; }
            100% { transform: scale(0.2); left: 100%; }
        }
        .loading-text-container {
            text-align: center;
            max-width: 600px;
            padding: 0 30px;
            width: 100%;
        }
        .loading-main-text {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2c3e50;
            min-height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            line-height: 1.4;
            word-wrap: break-word;
            word-break: keep-all;
            white-space: normal;
            max-width: 100%;
        }
        .loading-sub-text {
            font-size: 17px;
            color: #666;
            min-height: 60px;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            word-wrap: break-word;
            word-break: keep-all;
            white-space: normal;
            max-width: 100%;
        }
        .typing-effect {
            border-right: 2px solid #a1c4fd; /* 파스텔 블루 */
            animation: blink 1s infinite;
            overflow: visible;
            white-space: normal;
        }
        @keyframes blink {
            0%, 50% { border-color: #a1c4fd; } /* 파스텔 블루 */
            51%, 100% { border-color: transparent; }
        }
        .fade-effect {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            color: #2c3e50;
        }
        .fade-effect.active {
            opacity: 1;
        }
        .slide-effect {
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.6s ease-out;
            color: #2c3e50;
        }
        .slide-effect.active {
            transform: translateY(0);
            opacity: 1;
        }
        .color-changing {
            background: linear-gradient(90deg, #a1c4fd, #fbc2eb, #a1c4fd); /* 파스텔 계열 */
            background-size: 300% 100%;
            animation: gradientMove 3s ease-in-out infinite;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .dots::after {
            content: '';
            animation: dotsAnimation 1.5s steps(4, end) infinite;
        }
        @keyframes dotsAnimation {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        .progress-container {
            width: 100%;
            max-width: 400px;
            height: 6px;
            background: rgba(161, 196, 253, 0.15); /* 파스텔 블루 */
            border-radius: 10px;
            margin: 30px auto 0 auto;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #a1c4fd, #c2e9fb); /* 파스텔 블루 */
            border-radius: 10px;
            width: 0%;
            animation: progressMove 8s ease-in-out infinite;
        }
        @keyframes progressMove {
            0% { width: 0%; }
            20% { width: 25%; }
            40% { width: 50%; }
            60% { width: 75%; }
            80% { width: 90%; }
            100% { width: 100%; }
        }
        .consistent-text-size, .long-text {
            font-size: 22px !important;
            line-height: 1.4 !important;
            max-width: 95% !important;
        }
        .consistent-sub-text-size, .long-text.loading-sub-text {
            font-size: 16px !important;
            line-height: 1.5 !important;
            max-width: 95% !important;
        }
        .stable-color {
            color: #2c3e50 !important;
            -webkit-text-fill-color: #2c3e50 !important;
        }
        .stable-sub-color {
            color: #666 !important;
            -webkit-text-fill-color: #666 !important;
        }


        /* 배경 효과 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                    radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            body {
                padding: 70px 10px 5px 10px;
            }

            #header-logo {
                padding: 12px 15px 0;
            }

            #logo img {
                height: 40px;
            }

            .header-line {
                margin: 12px 0 0 0;
            }

            .container {
                padding: 20px;
                margin: 15px 10px;
                border-radius: 35px; /* 모바일 곡률 조정 */
            }
            #loadingOverlay {
                border-radius: 35px; /* 모바일 곡률 조정 */
            }

            .page-header {
                margin: -5px;
                border-radius: 35px 35px 0 0;
            }

            .fixed-bottom {
                margin: -5px;
                border-radius: 0 0 35px 35px;
            }

            .title {
                font-size: 28px;
            }

            .subtitle {
                font-size: 16px;
            }

            .text-input {
                font-size: 16px;
                padding: 18px;
                min-height: 100px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 15px;
            }

            .btn {
                padding: 12px 30px;
                font-size: 16px;
            }

            .examples-grid {
                grid-template-columns: 1fr;
            }

            .content-area {
                max-height: calc(100vh - 370px);
            }

            /* 로딩 텍스트 반응형 */
            .loading-text-container {
                padding: 0 20px;
                max-width: 90%;
            }

            .loading-main-text {
                font-size: 20px;
                min-height: 30px;
            }

            .loading-sub-text {
                font-size: 15px;
                min-height: 50px;
            }

            .loader {
                width: 50px;
                height: 50px;
                margin-bottom: 30px;
            }

            .loader:before,
            .loader:after {
                width: 20px;
                height: 20px;
                margin: -25px 0 0 -25px;
            }

            .progress-container {
                max-width: 300px;
                height: 5px;
                margin-top: 25px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 60px 10px 5px 10px;
            }

            #header-logo {
                padding: 10px 10px 0;
            }

            #logo img {
                height: 35px;
            }

            .header-line {
                margin: 10px 0 0 0;
            }

            .container {
                padding: 20px;
                margin: 10px;
                border-radius: 30px;
            }
            #loadingOverlay {
                border-radius: 30px; /* 모바일 곡률 조정 */
            }


            .page-header {
                margin: -5px;
                border-radius: 30px 30px 0 0;
            }

            .fixed-bottom {
                margin: -5px;
                border-radius: 0 0 30px 30px;
            }

            .suggestion-tags {
                justify-content: center;
            }

            .suggestion-tag {
                padding: 8px 15px;
                font-size: 13px;
            }

            .loading-text-container {
                padding: 0 15px;
            }

            .loading-main-text {
                font-size: 18px;
                line-height: 1.3;
            }

            .loading-sub-text {
                font-size: 14px;
                line-height: 1.5;
            }

            .progress-container {
                max-width: 250px;
                margin-top: 20px;
            }
        }

    </style>
</head>

<body>
<header id="header-logo">
    <div id="logo">
        <a th:href="@{/}">
            <img src="/images/moodtrip-logo-short.png" alt="MOODTRIP">
        </a>
    </div>
    <hr class="header-line">
</header>

<div class="container">
    <div class="page-header">
        <h1 class="title">현재 상황을 알려주세요</h1>
        <p class="subtitle">상황에 맞는 완벽한 장소를 추천해드릴게요</p>
        <div class="instruction floating-animation">&#128173; 자유롭게 상황이나 원하는 것을 적어주세요</div>
    </div>

    <div class="content-area">
        <form id="situationForm" th:action="@{/processSituation}" method="post">
            <input type="hidden" name="lat" th:value="${latitude}">
            <input type="hidden" name="lng" th:value="${longitude}">

            <div class="input-section">
                    <textarea
                            name="situationText"
                            id="situationInput"
                            class="text-input"
                            placeholder="예:
    • 친구들과 즐거운 시간을 보내고 싶어요
    • 혼자 조용히 책을 읽을 수 있는 곳을 찾아요
    • 데이트하기 좋은 분위기 있는 장소가 필요해요
    • 스트레스를 풀고 싶어서 신나게 놀 수 있는 곳을 원해요
    • 가족과 함께 맛있는 음식을 먹으러 가고 싶어요"
                            maxlength="500"
                            required></textarea>
                <div class="char-counter">
                    <span id="charCount">0</span>/500자
                </div>
            </div>

            <div class="suggestions">
                <div class="suggestions-title">&#128161; 빠른 선택</div>
                <div class="suggestion-tags">
                    <span class="suggestion-tag" onclick="setSuggestion('친구들과 함께 놀 수 있는 장소')">#친구들과 놀기</span>
                    <span class="suggestion-tag" onclick="setSuggestion('혼자만의 시간을 즐길 수 있는 장소')">#혼자만의 시간</span>
                    <span class="suggestion-tag" onclick="setSuggestion('로맨틱 데이트에 어울리는 핫스팟!')">#로맨틱 데이트</span>
                    <span class="suggestion-tag" onclick="setSuggestion('가족과 함께 추억을 쌓을 수 있는 장소')">#가족과 함께</span>
                    <span class="suggestion-tag" onclick="setSuggestion('스트레스 해소에 좋은 장소')">#스트레스 해소</span>
                    <span class="suggestion-tag" onclick="setSuggestion('새로운 경험을 하고 싶을 때 추천 장소')">#새로운 경험</span>
                    <span class="suggestion-tag" onclick="setSuggestion('맛집 탐방으로 추천 장소')">#맛집 탐방</span>
                    <span class="suggestion-tag" onclick="setSuggestion('문화생활의 필수 장소')">#문화생활</span>
                </div>
            </div>

            <div class="examples-section">
                <div class="examples-title">&#128221; 이런 식으로 적어보세요</div>
                <div class="examples-grid">
                    <div class="example-item">
                        <div class="example-label">감정 표현</div>
                        "요즘 너무 우울해서 기분전환이 필요해요"
                    </div>
                    <div class="example-item">
                        <div class="example-label">구체적 상황</div>
                        "회사 동료들과 회식 후 2차로 갈 곳을 찾아요"
                    </div>
                    <div class="example-item">
                        <div class="example-label">목적 중심</div>
                        "아이와 함께 교육적이면서 재미있는 곳에 가고 싶어요"
                    </div>
                </div>
            </div>

        </form>
    </div>

    <div class="fixed-bottom">
        <div class="action-buttons">
            <button type="submit" class="btn btn-primary" id="submitBtn" form="situationForm">
                상황에 맞는 장소 찾기 &#128269;
            </button>
            <a href="/" class="btn btn-secondary">
                ← 선택으로 돌아가기
            </a>
        </div>
    </div>
    <div id="loadingOverlay">
        <div class="loader"></div>
        <div class="loading-text-container">
            <div class="loading-main-text" id="mainText"></div>
            <div class="loading-sub-text" id="subText"></div>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // === 개선된 로딩 텍스트 애니메이션 === //
    const situationMainTexts = [
        "상황을 분석하고 있어요",
        "적합한 장소를 찾고 있어요",
        "맞춤형 추천을 준비하고 있어요",
        "완벽한 장소들을 골라내고 있어요",
        "곧 완료됩니다"
    ];
    const situationSubTexts = [
        "입력해주신 상황을 바탕으로 최적의 장소를 찾고 있습니다",
        "다양한 옵션 중에서 상황에 맞는 장소들을 선별하고 있어요",
        "위치와 상황을 고려한 개인화된 추천을 만들고 있습니다",
        "분위기와 특성을 고려한 특별한 장소들을 준비하고 있어요",
        "잠시만 기다려주세요. 멋진 추천 결과를 보여드릴게요!"
    ];

    let currentIndex = 0;
    let isAnimating = false;

    // === 개선된 애니메이션 함수들 === //
    function applyConsistentTextSize(mainElement, subElement) { mainElement.classList.add('consistent-text-size'); subElement.classList.add('consistent-sub-text-size'); }
    function typeText(element, text, speed = 50) {
        return new Promise((resolve) => {
            element.innerHTML = '';
            element.classList.add('typing-effect', 'stable-color');
            let i = 0;
            const timer = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                } else {
                    element.classList.remove('typing-effect');
                    clearInterval(timer);
                    resolve();
                }
            }, speed);
        });
    }
    function fadeInText(element, text, isSubText = false) {
        return new Promise((resolve) => {
            element.classList.add('fade-effect');
            if (isSubText) { element.classList.add('stable-sub-color'); } else { element.classList.add('stable-color'); }
            element.innerHTML = text.replace(/\n/g, '<br>');
            setTimeout(() => {
                element.classList.add('active');
                setTimeout(resolve, 800);
            }, 100);
        });
    }
    function slideInText(element, text, isSubText = false) {
        return new Promise((resolve) => {
            element.classList.add('slide-effect');
            if (isSubText) { element.classList.add('stable-sub-color'); } else { element.classList.add('stable-color'); }
            element.innerHTML = text.replace(/\n/g, '<br>');
            setTimeout(() => {
                element.classList.add('active');
                setTimeout(resolve, 600);
            }, 100);
        });
    }
    function colorChangeText(element, text) {
        return new Promise((resolve) => {
            element.classList.add('color-changing');
            element.innerHTML = text.replace(/\n/g, '<br>');
            setTimeout(resolve, 1500);
        });
    }
    function resetTextEffects(element) {
        element.classList.remove(
            'fade-effect', 'active', 'slide-effect', 'color-changing',
            'typing-effect', 'stable-color', 'stable-sub-color'
        );
    }

    // === 메인 애니메이션 함수 === //
    async function animateTexts() {
        if (isAnimating) return;
        isAnimating = true;

        const mainTextEl = document.getElementById('mainText');
        const subTextEl = document.getElementById('subText');
        applyConsistentTextSize(mainTextEl, subTextEl);

        for (let i = 0; i < situationMainTexts.length; i++) {
            currentIndex = i;
            resetTextEffects(mainTextEl);
            resetTextEffects(subTextEl);
            const effects = ['typing', 'fade', 'slide', 'color'];
            const currentEffect = effects[i % effects.length];

            switch (currentEffect) {
                case 'typing':
                    await typeText(mainTextEl, situationMainTexts[i], 60);
                    await fadeInText(subTextEl, situationSubTexts[i], true);
                    break;
                case 'fade':
                    await fadeInText(mainTextEl, situationMainTexts[i], false);
                    await slideInText(subTextEl, situationSubTexts[i], true);
                    break;
                case 'slide':
                    await slideInText(mainTextEl, situationMainTexts[i], false);
                    await fadeInText(subTextEl, situationSubTexts[i], true);
                    break;
                case 'color':
                    await colorChangeText(mainTextEl, situationMainTexts[i]);
                    await typeText(subTextEl, situationSubTexts[i], 40);
                    subTextEl.classList.add('stable-sub-color');
                    break;
            }
            if (i < situationMainTexts.length - 1) {
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
        }
        const finalText = document.createElement('span');
        finalText.innerHTML = situationMainTexts[situationMainTexts.length - 1] + '<span class="dots"></span>';
        finalText.className = 'stable-color';
        mainTextEl.innerHTML = '';
        mainTextEl.appendChild(finalText);
        isAnimating = false;
    }

    // === 기존 상황 입력 기능들 === //

    const situationInput = document.getElementById('situationInput');
    const charCount = document.getElementById('charCount');
    const submitBtn = document.getElementById('submitBtn');

    // 글자 수 카운터 업데이트
    function updateCharCount() {
        const length = situationInput.value.length;
        charCount.textContent = length;

        // 버튼 활성화/비활성화
        if (length > 0 && length <= 500) {
            submitBtn.classList.add('active');
        } else {
            submitBtn.classList.remove('active');
        }

        // 글자 수 색상 변경
        if (length > 450) {
            charCount.style.color = '#dc3545';
        } else if (length > 400) {
            charCount.style.color = '#ffc107';
        } else {
            charCount.style.color = '#666';
        }
    }

    // 추천 태그 클릭 시 텍스트 설정
    function setSuggestion(text) {
        situationInput.value = text;
        updateCharCount();
        situationInput.focus();

        // 애니메이션 효과
        situationInput.style.transform = 'scale(1.02)';
        setTimeout(() => {
            situationInput.style.transform = 'scale(1)';
        }, 200);
    }

    // 이벤트 리스너
    situationInput.addEventListener('input', updateCharCount);
    situationInput.addEventListener('paste', () => {
        setTimeout(updateCharCount, 10);
    });

    document.getElementById('situationForm').addEventListener('submit', function(e) {
        const text = situationInput.value.trim();
        if (text.length === 0) {
            e.preventDefault();
            alert('상황을 입력해주세요!');
            situationInput.focus();
        } else if (text.length > 500) {
            e.preventDefault();
            alert('500자 이내로 입력해주세요!');
            situationInput.focus();
        } else {
            document.getElementById('loadingOverlay').style.display = 'flex';
            animateTexts();
        }
    });

    updateCharCount();

    situationInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.max(this.scrollHeight, 120) + 'px';
    });
    situationInput.addEventListener('focus', function() {
        this.style.borderColor = '#a1c4fd';
        this.style.boxShadow = '0 0 0 5px rgba(161, 196, 253, 0.25)';
    });
    situationInput.addEventListener('blur', function() {
        if (!this.value) {
            this.style.borderColor = '#e0e0e0';
            this.style.boxShadow = 'none';
        }
    });
    situationInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
        }
    });
</script>
</body>
</html>